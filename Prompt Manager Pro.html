<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Manager Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            height: 90vh;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            color: white;
            display: flex;
            flex-direction: column;
            border-right: 2px solid #667eea;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h1 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 12px;
            color: #bdc3c7;
        }

        .templates-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .template-item {
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .template-item:hover {
            background: rgba(255,255,255,0.2);
            border-left-color: #667eea;
        }

        .template-item.active {
            background: #667eea;
            border-left-color: #fff;
        }

        .template-item-name {
            font-size: 13px;
            font-weight: 500;
            flex: 1;
            word-break: break-word;
        }

        .template-delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            opacity: 0;
            transition: opacity 0.2s;
            flex-shrink: 0;
            margin-left: 8px;
        }

        .template-item:hover .template-delete-btn {
            opacity: 1;
        }

        .sidebar-footer {
            padding: 15px;
            border-top: 2px solid rgba(255,255,255,0.1);
            display: flex;
            gap: 10px;
        }

        .btn-primary {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-bar {
            padding: 20px 30px;
            background: white;
            border-bottom: 2px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .top-bar h2 {
            color: #2c3e50;
            font-size: 22px;
        }

        .top-bar-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-secondary {
            padding: 10px 16px;
            background: #ecf0f1;
            color: #2c3e50;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 12px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn-secondary:hover {
            background: #d5dbdb;
            border-color: #95a5a6;
        }

        .content-area {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .form-section {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .preview-section {
            flex: 0 0 380px;
            padding: 30px;
            background: white;
            border-left: 2px solid #ecf0f1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
            font-family: 'Menlo', 'Monaco', monospace;
            font-size: 12px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .preview-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .preview-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            font-size: 12px;
            line-height: 1.6;
            color: #34495e;
            font-family: 'Menlo', 'Monaco', monospace;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #95a5a6;
            text-align: center;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .stat-card-label {
            font-size: 11px;
            color: #95a5a6;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .stat-card-value {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }

        .btn-danger {
            padding: 10px 16px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .copy-btn {
            width: 100%;
            padding: 12px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 15px;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #27ae60;
        }

        .copy-success {
            background: #27ae60;
        }

        .tag-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 8px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            min-height: 40px;
        }

        .tag {
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tag-remove {
            cursor: pointer;
            font-weight: bold;
        }

        .tag-input input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 100px;
            font-size: 13px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            animation: slideIn 0.3s ease;
            max-width: 300px;
            word-break: break-word;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .scroll-hint {
            font-size: 11px;
            color: #95a5a6;
            margin-top: 10px;
            text-align: center;
        }

        .modal-form-group {
            margin-bottom: 15px;
        }

        .modal-form-label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 6px;
            font-size: 12px;
        }

        .modal-form-input, .modal-form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 12px;
            font-family: inherit;
        }

        .modal-form-textarea {
            resize: vertical;
            min-height: 80px;
            font-family: 'Menlo', 'Monaco', monospace;
        }

        .export-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-family: 'Menlo', 'Monaco', monospace;
            font-size: 11px;
            height: 300px;
            resize: vertical;
            background: #f8f9fa;
        }

        .import-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-family: 'Menlo', 'Monaco', monospace;
            font-size: 11px;
            height: 300px;
            resize: vertical;
        }

        .modal-description {
            color: #34495e;
            margin-bottom: 15px;
            font-size: 13px;
            line-height: 1.6;
        }

        @media (max-width: 1024px) {
            .preview-section {
                flex: 0 0 320px;
            }

            .container {
                height: 95vh;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
            }

            .sidebar {
                width: 100%;
                min-height: 150px;
                flex-direction: row;
            }

            .templates-list {
                overflow-x: auto;
                overflow-y: hidden;
                display: flex;
                gap: 10px;
                padding: 15px;
            }

            .template-item {
                margin: 0;
                white-space: nowrap;
                flex-shrink: 0;
                min-width: 120px;
            }

            .content-area {
                flex-direction: column;
            }

            .preview-section {
                flex: 0 0 250px;
                border-left: none;
                border-top: 2px solid #ecf0f1;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .sidebar-footer {
                flex-direction: column;
            }

            .btn-primary {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>ğŸ“‹ AI í”„ë¡¬í”„íŠ¸</h1>
                <p>í…œí”Œë¦¿ ê´€ë¦¬ì</p>
            </div>

            <div class="templates-list" id="templatesList">
                <div class="empty-state" style="padding: 20px; text-align: center;">
                    <p style="font-size: 12px;">í…œí”Œë¦¿ì„ ìƒì„±í•´ë³´ì„¸ìš”!</p>
                </div>
            </div>

            <div class="sidebar-footer">
                <button class="btn-primary" onclick="addNewTemplate()">+ í…œí”Œë¦¿</button>
                <button class="btn-primary" onclick="openAddFieldModal()" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">+ í•­ëª©</button>
            </div>
        </div>

        <div class="main-content">
            <div class="top-bar">
                <h2 id="templateTitle">í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ê´€ë¦¬</h2>
                <div class="top-bar-actions">
                    <button class="btn-secondary" onclick="openExportModal()">ğŸ“¥ JSON ë‚´ë³´ë‚´ê¸°</button>
                    <button class="btn-secondary" onclick="openImportModal()">ğŸ“¤ JSON ê°€ì ¸ì˜¤ê¸°</button>
                </div>
            </div>

            <div class="content-area">
                <div class="form-section" id="formSection">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“</div>
                        <p>ìƒˆ í…œí”Œë¦¿ì„ ë§Œë“¤ê±°ë‚˜ ê¸°ì¡´ í…œí”Œë¦¿ì„ ì„ íƒí•˜ì„¸ìš”</p>
                    </div>
                </div>

                <div class="preview-section" id="previewSection">
                    <div style="padding: 20px; text-align: center; color: #95a5a6;">
                        <p style="font-size: 12px;">í”„ë¦¬ë·°ê°€ í‘œì‹œë©ë‹ˆë‹¤</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header">í…œí”Œë¦¿ ì‚­ì œ í™•ì¸</div>
            <p style="color: #34495e; margin-bottom: 20px;">ì •ë§ë¡œ ì´ í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="cancelDelete()">ì·¨ì†Œ</button>
                <button class="btn-danger" onclick="confirmDelete()">ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">ğŸ“¥ JSON ë‚´ë³´ë‚´ê¸°</div>
            <p class="modal-description">ì•„ë˜ JSON í…ìŠ¤íŠ¸ë¥¼ ë³µì‚¬í•˜ì—¬ ë©”ëª¨ì¥ì— ë¶™ì—¬ë„£ì€ í›„ <code>.json</code> í™•ì¥ìë¡œ ì €ì¥í•˜ì„¸ìš”.</p>
            <textarea id="exportTextarea" class="export-textarea" readonly></textarea>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeExportModal()">ë‹«ê¸°</button>
                <button class="btn-primary" onclick="copyExportJSON()">ğŸ“‹ ì „ì²´ ë³µì‚¬</button>
            </div>
        </div>
    </div>

    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">ğŸ“¤ JSON ê°€ì ¸ì˜¤ê¸°</div>
            <p class="modal-description">ì €ì¥ëœ JSON íŒŒì¼ì˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ì•„ë˜ì— ë¶™ì—¬ë„£ì€ í›„ "ë¶ˆëŸ¬ì˜¤ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
            <textarea id="importTextarea" class="import-textarea" placeholder="JSON í…ìŠ¤íŠ¸ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeImportModal()">ì·¨ì†Œ</button>
                <button class="btn-primary" onclick="loadFromImportModal()">ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
        </div>
    </div>

    <div class="modal" id="addFieldModal">
        <div class="modal-content">
            <div class="modal-header">âœ¨ ìƒˆë¡œìš´ í•­ëª© ì¶”ê°€</div>
            <p style="color: #34495e; margin-bottom: 15px; font-size: 12px;">ëª¨ë“  í…œí”Œë¦¿ì— ì¶”ê°€ë  ìƒˆ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”</p>
            
            <div class="modal-form-group">
                <label class="modal-form-label">í•­ëª© ì´ë¦„ (ì˜ë¬¸)</label>
                <input type="text" class="modal-form-input" id="newFieldName" placeholder="ì˜ˆ: custom_field" onkeyup="this.value = this.value.replace(/[^a-z0-9_]/g, '')">
            </div>

            <div class="modal-form-group">
                <label class="modal-form-label">í•­ëª© ë¼ë²¨ (í•œê¸€)</label>
                <input type="text" class="modal-form-input" id="newFieldLabel" placeholder="ì˜ˆ: ì»¤ìŠ¤í…€ í•­ëª©">
            </div>

            <div class="modal-form-group">
                <label class="modal-form-label">ê¸°ë³¸ê°’</label>
                <textarea class="modal-form-textarea" id="newFieldDefault" placeholder="ì´ í•­ëª©ì˜ ê¸°ë³¸ê°’ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>

            <div style="background: #fffbeb; padding: 12px; border-radius: 6px; border-left: 3px solid #f59e0b; margin-bottom: 20px; font-size: 12px; color: #78350f;">
                <strong>âš ï¸ ì£¼ì˜:</strong> í•­ëª©ëª…ì€ ì˜ë¬¸ ì†Œë¬¸ì, ìˆ«ì, ì–¸ë”ìŠ¤ì½”ì–´(_)ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
            </div>

            <div class="modal-buttons">
                <button class="btn-secondary" onclick="cancelAddField()">ì·¨ì†Œ</button>
                <button class="btn-primary" onclick="confirmAddField()">í•­ëª© ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <script>
        let customFields = [];
        let inMemoryStorage = { promptManagerSettings: null };
        
        const defaultTemplates = [
            {
                id: 1, name: "ë¸”ë¡œê·¸ ì‘ì„±", role: "ì „ë¬¸ ë¸”ë¡œê±°", goal: "ë…ìë“¤ì„ ìœ„í•œ ê³ í’ˆì§ˆ ì½˜í…ì¸  ì‘ì„±",
                audience: "ê¸°ìˆ  ë¸”ë¡œê·¸ ë…ì", task_type: "ì‘ì„±", input_desc: "ì£¼ì œ, í‚¤ì›Œë“œ, ëª©í‘œ ë…ìì¸µ",
                output_format: "ë§ˆí¬ë‹¤ìš´ í˜•ì‹", tone: "ì „ë¬¸ì ì´ë©´ì„œ ì¹œê·¼í•œ", length_constraints: "1500~2000ë‹¨ì–´",
                extra_instructions: "SEO ìµœì í™” í•„ìˆ˜, ì´ë¯¸ì§€ ì„¤ëª… í¬í•¨", tags: ["ë¸”ë¡œê·¸", "ì½˜í…ì¸ "], topic: ""
            },
            {
                id: 2, name: "ì½”ë“œ ë¦¬ë·°", role: "ê²½í—˜ ë§ì€ ì½”ë“œ ë¦¬ë·°ì–´", goal: "ì½”ë“œ í’ˆì§ˆ í–¥ìƒ ë° ë²„ê·¸ ì‚¬ì „ ë°©ì§€",
                audience: "ê°œë°œíŒ€ ë©¤ë²„", task_type: "ì½”ë“œë¦¬ë·°", input_desc: "ë¦¬ë·°í•  ì½”ë“œ ìŠ¤ë‹ˆí« ë˜ëŠ” íŒŒì¼",
                output_format: "êµ¬ì¡°í™”ëœ í”¼ë“œë°± ë¦¬ìŠ¤íŠ¸", tone: "ê±´ì„¤ì ì´ê³  ì¡´ì¤‘í•˜ëŠ”", length_constraints: "ëª…ì‹œì  ì œì•½ ì—†ìŒ",
                extra_instructions: "ì„±ëŠ¥, ë³´ì•ˆ, ê°€ë…ì„± ê´€ì ì—ì„œ ë¶„ì„", tags: ["ê°œë°œ", "ì½”ë“œ"], topic: ""
            },
            {
                id: 3, name: "í”„ë¡œê·¸ë¨ ì†ŒìŠ¤ì½”ë“œ", role: "ìˆ™ë ¨ëœ ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´", goal: "ìš”êµ¬ì‚¬í•­ì— ë§ëŠ” ê³ í’ˆì§ˆ ì½”ë“œ ì‘ì„±",
                audience: "ê°œë°œì", task_type: "ì½”ë“œë¦¬ë·°", input_desc: "í”„ë¡œê·¸ë˜ë° ì–¸ì–´, í•„ìš”í•œ ê¸°ëŠ¥, ì œì•½ì‚¬í•­",
                output_format: "ì™„ì „í•œ ì½”ë“œ ë¸”ë¡", tone: "ì „ë¬¸ì ì´ê³  ìƒì„¸í•œ", length_constraints: "ì œì•½ ì—†ìŒ",
                extra_instructions: "ì£¼ì„ í¬í•¨, ì—ëŸ¬ ì²˜ë¦¬ í•„ìˆ˜, íš¨ìœ¨ì ì¸ ì•Œê³ ë¦¬ì¦˜", tags: ["ì½”ë“œ", "ê°œë°œ", "í”„ë¡œê·¸ë˜ë°"], topic: ""
            },
            {
                id: 4, name: "ì‹œë‚˜ë¦¬ì˜¤ ëŒ€ë³¸", role: "ì°½ì˜ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ ì‘ê°€", goal: "ë§¤ë ¥ì ì¸ ìŠ¤í† ë¦¬ì™€ ëŒ€ì‚¬ ì‘ì„±",
                audience: "ì˜ìƒì œì‘ì, ë°°ìš°", task_type: "ì‹œë‚˜ë¦¬ì˜¤", input_desc: "ì¥ë¥´, ì£¼ìš” ìºë¦­í„°, ì¤„ê±°ë¦¬ ê°œìš”, ëŸ¬ë‹íƒ€ì„",
                output_format: "ë§ˆí¬ë‹¤ìš´ ì‹œë‚˜ë¦¬ì˜¤ í˜•ì‹", tone: "ì°½ì˜ì ì´ê³  ê°ì •ì ", length_constraints: "ë¶„ëŸ‰ì— ë”°ë¼ ê°€ë³€",
                extra_instructions: "ìºë¦­í„° ì„±ê²© ì¼ê´€ì„± ìœ ì§€, ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€ì‚¬", tags: ["ì‹œë‚˜ë¦¬ì˜¤", "ì°½ì˜", "ìŠ¤í¬ë¦½íŠ¸"], topic: ""
            },
            {
                id: 5, name: "ê·¸ë¦¼ ìƒì„± ìš”ì²­", role: "í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´", goal: "AI ì´ë¯¸ì§€ ìƒì„±ì„ ìœ„í•œ ì •í™•í•œ ì§€ì‹œì‚¬í•­ ì‘ì„±",
                audience: "ì´ë¯¸ì§€ ìƒì„± AI ì‚¬ìš©ì", task_type: "ê¸°íš", input_desc: "ì›í•˜ëŠ” ì´ë¯¸ì§€ì˜ ì£¼ì œ, ìŠ¤íƒ€ì¼, ë¶„ìœ„ê¸°, í•´ìƒë„",
                output_format: "ìƒì„¸í•œ í”„ë¡¬í”„íŠ¸ í…ìŠ¤íŠ¸", tone: "ìƒì„¸í•˜ê³  êµ¬ì²´ì ", length_constraints: "ì§§ê³  ëª…í™•í•˜ê²Œ",
                extra_instructions: "êµ¬ì²´ì  í˜•ìš©ì‚¬ ì‚¬ìš©, ìŠ¤íƒ€ì¼ ëª…ì‹œ, í™”ì§ˆ ì§€ì •", tags: ["ì´ë¯¸ì§€", "AI", "ê·¸ë¦¼"], topic: ""
            },
            {
                id: 6, name: "ì§€ì›ì„œ (ìê¸°ì†Œê°œì„œ)", role: "ê²½í—˜ ë§ì€ ì·¨ì—… ì»¨ì„¤í„´íŠ¸", goal: "ì±„ìš©ë‹´ë‹¹ìì˜ ë§ˆìŒì„ ì‚¬ë¡œì¡ëŠ” ìê¸°ì†Œê°œì„œ ì‘ì„±",
                audience: "ì·¨ì—… ì¤€ë¹„ìƒ", task_type: "ì‘ì„±", input_desc: "ì§€ì› ê¸°ì—…ëª…, ì§ë¬´, ê°œì¸ ê²½ë ¥/íŠ¹ê¸°, ì§€ì› ë™ê¸°",
                output_format: "ë§ˆí¬ë‹¤ìš´ í˜•ì‹ ë¬¸ì„œ", tone: "ì „ë¬¸ì ì´ë©´ì„œ ë”°ëœ»í•œ", length_constraints: "800~1000ë‹¨ì–´",
                extra_instructions: "ê°œì¸ì˜ ê°•ì  ë¶€ê°, ê°ì • í‘œí˜„, êµ¬ì²´ì  ì‚¬ë¡€ í¬í•¨", tags: ["ì§€ì›ì„œ", "ì·¨ì—…", "ìì†Œì„œ"], topic: ""
            },
            {
                id: 12, name: "ê¸°íƒ€", role: "", goal: "", audience: "", task_type: "ê¸°íƒ€", input_desc: "",
                output_format: "", tone: "ì¤‘ë¦½ì ", length_constraints: "", extra_instructions: "ììœ ë¡­ê²Œ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•˜ì„¸ìš”",
                tags: ["ì»¤ìŠ¤í…€"], topic: ""
            }
        ];

        let templates = JSON.parse(JSON.stringify(defaultTemplates));
        let currentTemplateId = null;
        let deleteTargetId = null;

        function init() {
            loadSettings();
            renderTemplatesList();
            if (templates.length > 0) selectTemplate(templates[0].id);
        }

        function loadSettings() {
            const saved = inMemoryStorage.promptManagerSettings;
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    templates = data.templates || JSON.parse(JSON.stringify(defaultTemplates));
                    customFields = data.customFields || [];
                    addCustomFieldsToTemplates();
                } catch (e) {
                    console.error('[ERROR]', e);
                }
            }
        }

        function saveSettings() {
            try {
                inMemoryStorage.promptManagerSettings = JSON.stringify({
                    templates: templates,
                    customFields: customFields,
                    version: '1.0',
                    savedAt: new Date().toISOString()
                });
                showToast('ğŸ’¾ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
            } catch (e) {
                showToast('âš ï¸ ì €ì¥ ì‹¤íŒ¨');
            }
        }

        function addCustomFieldsToTemplates() {
            templates.forEach(template => {
                customFields.forEach(field => {
                    if (!(field.name in template)) {
                        template[field.name] = field.default || '';
                    }
                });
            });
        }

        function renderTemplatesList() {
            const list = document.getElementById('templatesList');
            list.innerHTML = templates.length === 0 
                ? '<div class="empty-state" style="padding: 20px;"><p style="font-size: 12px;">í…œí”Œë¦¿ì„ ìƒì„±í•´ë³´ì„¸ìš”!</p></div>'
                : templates.map(t => `
                    <div class="template-item ${t.id === currentTemplateId ? 'active' : ''}" onclick="selectTemplate(${t.id})">
                        <span class="template-item-name">${t.name}</span>
                        <button class="template-delete-btn" onclick="deleteTemplate(${t.id}, event)">ì‚­ì œ</button>
                    </div>
                `).join('');
        }

        function selectTemplate(id) {
            currentTemplateId = id;
            renderTemplatesList();
            renderForm();
            updatePreview();
        }

        function renderForm() {
            const template = templates.find(t => t.id === currentTemplateId);
            if (!template) return;

            const taskOptions = ['ë¦¬ì„œì¹˜', 'ì •ë¦¬', 'ìš”ì•½', 'ì½”ë“œë¦¬ë·°', 'ê¸°íš', 'ìŠ¤í¬ë¦½íŠ¸', 'ì‹œë‚˜ë¦¬ì˜¤', 'ë²ˆì—­', 'ë¶„ì„', 'ê¸°íƒ€'];
            const toneOptions = ['ìºì£¼ì–¼', 'ì „ë¬¸ì ', 'ì¹œê·¼í•œ', 'í¬ë©€', 'ìœ ë¨¸ëŸ¬ìŠ¤', 'ì¤‘ë¦½ì '];

            let formHTML = `
                <div class="form-group">
                    <label class="form-label">ğŸ“Œ í…œí”Œë¦¿ ì´ë¦„</label>
                    <input type="text" class="form-input" value="${escapeAttr(template.name)}" onchange="updateTemplate('name', this.value)" onkeyup="updatePreview()">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ğŸ­ ì—­í•  (Role)</label>
                        <input type="text" class="form-input" value="${escapeAttr(template.role)}" onchange="updateTemplate('role', this.value)" onkeyup="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ğŸ¯ ëª©í‘œ (Goal)</label>
                        <input type="text" class="form-input" value="${escapeAttr(template.goal)}" onchange="updateTemplate('goal', this.value)" onkeyup="updatePreview()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ğŸ‘¥ ëŒ€ìƒ (Audience)</label>
                        <input type="text" class="form-input" value="${escapeAttr(template.audience)}" onchange="updateTemplate('audience', this.value)" onkeyup="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ğŸ”§ ì‘ì—… ìœ í˜•</label>
                        <select class="form-select" onchange="updateTemplate('task_type', this.value); updatePreview()">
                            ${taskOptions.map(opt => `<option ${template.task_type === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ“¥ ì…ë ¥ ì„¤ëª…</label>
                    <textarea class="form-textarea" onchange="updateTemplate('input_desc', this.value)" onkeyup="updatePreview()">${escapeHtml(template.input_desc)}</textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ğŸ“¤ ì¶œë ¥ í˜•ì‹</label>
                        <input type="text" class="form-input" value="${escapeAttr(template.output_format)}" onchange="updateTemplate('output_format', this.value)" onkeyup="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ğŸ’¬ í†¤</label>
                        <select class="form-select" onchange="updateTemplate('tone', this.value); updatePreview()">
                            ${toneOptions.map(opt => `<option ${template.tone === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ“ ê¸¸ì´/ì œì•½</label>
                    <input type="text" class="form-input" value="${escapeAttr(template.length_constraints)}" onchange="updateTemplate('length_constraints', this.value)" onkeyup="updatePreview()">
                </div>
                <div class="form-group">
                    <label class="form-label">âš™ï¸ ì¶”ê°€ ì§€ì‹œì‚¬í•­</label>
                    <textarea class="form-textarea" onchange="updateTemplate('extra_instructions', this.value)" onkeyup="updatePreview()">${escapeHtml(template.extra_instructions)}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ·ï¸ íƒœê·¸</label>
                    <div class="tag-input">
                        ${template.tags.map(tag => `<div class="tag">${escapeHtml(tag)}<span class="tag-remove" onclick="removeTag('${tag}')">Ã—</span></div>`).join('')}
                        <input type="text" placeholder="íƒœê·¸ ì¶”ê°€..." onkeypress="addTag(event, this)">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">â“ ìµœì¢… ì§ˆë¬¸/ì£¼ì œ</label>
                    <textarea class="form-textarea" onchange="updateTemplate('topic', this.value)" onkeyup="updatePreview()">${escapeHtml(template.topic)}</textarea>
                </div>
            `;

            customFields.forEach(field => {
                const value = template[field.name] || '';
                formHTML += `
                    <div class="form-group">
                        <label class="form-label">âœ¨ ${field.label}</label>
                        <textarea class="form-textarea" onchange="updateTemplate('${field.name}', this.value)" onkeyup="updatePreview()">${escapeHtml(value)}</textarea>
                    </div>
                `;
            });

            document.getElementById('formSection').innerHTML = formHTML;
            document.getElementById('templateTitle').textContent = template.name || 'ë¬´ì œ';
        }

        function updateTemplate(field, value) {
            const template = templates.find(t => t.id === currentTemplateId);
            if (template) {
                template[field] = value;
                saveSettings();
                updatePreview();
            }
        }

        function addTag(event, input) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const tag = input.value.trim();
                const template = templates.find(t => t.id === currentTemplateId);
                if (tag && !template.tags.includes(tag)) {
                    template.tags.push(tag);
                    saveSettings();
                    renderForm();
                    updatePreview();
                }
                input.value = '';
            }
        }

        function removeTag(tag) {
            const template = templates.find(t => t.id === currentTemplateId);
            template.tags = template.tags.filter(t => t !== tag);
            saveSettings();
            renderForm();
            updatePreview();
        }

        function updatePreview() {
            const template = templates.find(t => t.id === currentTemplateId);
            if (!template) return;

            let prompt = `ã€AI í”„ë¡¬í”„íŠ¸ã€‘\n\nğŸ“Œ ì—­í• : ${template.role}\nğŸ¯ ëª©í‘œ: ${template.goal}\nğŸ‘¥ ëŒ€ìƒ: ${template.audience}\nğŸ”§ ì‘ì—…: ${template.task_type}\n\n`;
            prompt += `ğŸ“¥ ì…ë ¥\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${template.input_desc}\n\nğŸ“¤ ì¶œë ¥\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\ní˜•ì‹: ${template.output_format}\ní†¤: ${template.tone}\nê¸¸ì´: ${template.length_constraints}\n\n`;

            if (template.extra_instructions) prompt += `âš™ï¸ ì¶”ê°€ ì§€ì‹œì‚¬í•­\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${template.extra_instructions}\n\n`;

            customFields.forEach(field => {
                if (template[field.name]) prompt += `âœ¨ ${field.label}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${template[field.name]}\n\n`;
            });

            if (template.tags.length > 0) prompt += `ğŸ·ï¸ íƒœê·¸: ${template.tags.join(', ')}\n\n`;
            if (template.topic) prompt += `â“ ì§ˆë¬¸\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${template.topic}\n`;

            const stats = {
                templates: templates.length,
                fields: 9 + customFields.length,
                tags: template.tags.length,
                wordCount: (template.role + template.goal + template.audience + template.input_desc + template.extra_instructions + template.topic).split(/\s+/).filter(w => w).length
            };

            const statsHtml = `<div class="stats-grid">
                <div class="stat-card"><div class="stat-card-label">ì´ í…œí”Œë¦¿</div><div class="stat-card-value">${stats.templates}</div></div>
                <div class="stat-card"><div class="stat-card-label">í•­ëª© ìˆ˜</div><div class="stat-card-value">${stats.fields}</div></div>
                <div class="stat-card"><div class="stat-card-label">íƒœê·¸</div><div class="stat-card-value">${stats.tags}</div></div>
                <div class="stat-card"><div class="stat-card-label">ë‹¨ì–´ ìˆ˜</div><div class="stat-card-value">${stats.wordCount}</div></div>
            </div>`;

            document.getElementById('previewSection').innerHTML = statsHtml + `
                <div style="border-top: 1px solid #ecf0f1; padding-top: 20px;">
                    <div class="preview-title">ğŸ“‹ ìƒì„±ëœ í”„ë¡¬í”„íŠ¸</div>
                    <button class="copy-btn" onclick="copyPrompt()">ğŸ“‹ í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
                    <div class="preview-content">${escapeHtml(prompt)}</div>
                    <div class="scroll-hint">í”„ë¡¬í”„íŠ¸ê°€ ê¸¸ ê²½ìš° ìŠ¤í¬ë¡¤í•˜ì—¬ í™•ì¸</div>
                </div>
            `;

            window.currentPrompt = prompt;
        }

        function copyPrompt() {
            if (!window.currentPrompt) {
                showToast('ë³µì‚¬í•  í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            const textarea = document.createElement('textarea');
            textarea.value = window.currentPrompt;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            
            textarea.select();
            const success = document.execCommand('copy');
            document.body.removeChild(textarea);

            if (success) {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = 'âœ… ë³µì‚¬ë¨!';
                btn.classList.add('copy-success');
                showToast('âœ… í”„ë¡¬í”„íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
                setTimeout(() => {
                    btn.textContent = 'ğŸ“‹ í”„ë¡¬í”„íŠ¸ ë³µì‚¬';
                    btn.classList.remove('copy-success');
                }, 2000);
            } else {
                showToast('âš ï¸ ë³µì‚¬ ì‹¤íŒ¨');
            }
        }

        function addNewTemplate() {
            const newId = Math.max(...templates.map(t => t.id), 0) + 1;
            const newTemplate = {
                id: newId, name: `ìƒˆ í…œí”Œë¦¿ ${newId}`, role: "", goal: "", audience: "",
                task_type: "ë¦¬ì„œì¹˜", input_desc: "", output_format: "", tone: "ì „ë¬¸ì ",
                length_constraints: "", extra_instructions: "", tags: [], topic: ""
            };
            customFields.forEach(field => newTemplate[field.name] = field.default || '');
            templates.push(newTemplate);
            saveSettings();
            renderTemplatesList();
            selectTemplate(newId);
            showToast('âœ… ìƒˆ í…œí”Œë¦¿ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function openAddFieldModal() {
            document.getElementById('addFieldModal').classList.add('active');
            document.getElementById('newFieldName').value = '';
            document.getElementById('newFieldLabel').value = '';
            document.getElementById('newFieldDefault').value = '';
            document.getElementById('newFieldName').focus();
        }

        function confirmAddField() {
            const name = document.getElementById('newFieldName').value.trim();
            const label = document.getElementById('newFieldLabel').value.trim();
            const defaultValue = document.getElementById('newFieldDefault').value.trim();

            if (!name) { showToast('âš ï¸ í•­ëª© ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
            if (!label) { showToast('âš ï¸ í•­ëª© ë¼ë²¨ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
            if (customFields.some(f => f.name === name)) { showToast('âš ï¸ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í•­ëª© ì´ë¦„ì…ë‹ˆë‹¤'); return; }
            if (['name', 'role', 'goal', 'audience', 'task_type', 'input_desc', 'output_format', 'tone', 'length_constraints', 'extra_instructions', 'tags', 'topic', 'id'].includes(name)) {
                showToast('âš ï¸ ì˜ˆì•½ëœ í•­ëª© ì´ë¦„ì…ë‹ˆë‹¤'); return;
            }

            customFields.push({ name: name, label: label, default: defaultValue });
            templates.forEach(template => template[name] = defaultValue);
            saveSettings();
            cancelAddField();
            renderForm();
            updatePreview();
            showToast(`âœ… '${label}' í•­ëª©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }

        function cancelAddField() {
            document.getElementById('addFieldModal').classList.remove('active');
        }

        function deleteTemplate(id, event) {
            event.stopPropagation();
            deleteTargetId = id;
            document.getElementById('deleteModal').classList.add('active');
        }

        function confirmDelete() {
            templates = templates.filter(t => t.id !== deleteTargetId);
            saveSettings();
            document.getElementById('deleteModal').classList.remove('active');
            if (currentTemplateId === deleteTargetId && templates.length > 0) {
                selectTemplate(templates[0].id);
            } else if (templates.length === 0) {
                currentTemplateId = null;
                document.getElementById('formSection').innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“</div><p>ìƒˆ í…œí”Œë¦¿ì„ ë§Œë“¤ê±°ë‚˜ ê¸°ì¡´ í…œí”Œë¦¿ì„ ì„ íƒí•˜ì„¸ìš”</p></div>';
            }
            renderTemplatesList();
            showToast('âœ… í…œí”Œë¦¿ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function cancelDelete() {
            document.getElementById('deleteModal').classList.remove('active');
        }

        function openExportModal() {
            try {
                const data = {
                    version: '1.0',
                    exportedAt: new Date().toISOString(),
                    templates: templates,
                    customFields: customFields
                };
                const dataStr = JSON.stringify(data, null, 2);
                document.getElementById('exportTextarea').value = dataStr;
                document.getElementById('exportModal').classList.add('active');
            } catch (error) {
                showToast('âš ï¸ JSON ìƒì„± ì‹¤íŒ¨');
            }
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('active');
        }

        function copyExportJSON() {
            const textarea = document.getElementById('exportTextarea');
            textarea.select();
            const success = document.execCommand('copy');
            
            if (success) {
                showToast('âœ… JSONì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ë©”ëª¨ì¥ì— ë¶™ì—¬ë„£ê¸° í›„ .jsonìœ¼ë¡œ ì €ì¥í•˜ì„¸ìš”.');
                const btn = event.target;
                btn.textContent = 'âœ… ë³µì‚¬ë¨!';
                btn.style.background = '#27ae60';
                setTimeout(() => {
                    btn.textContent = 'ğŸ“‹ ì „ì²´ ë³µì‚¬';
                    btn.style.background = '';
                }, 2000);
            } else {
                showToast('âš ï¸ ë³µì‚¬ ì‹¤íŒ¨');
            }
        }

        function openImportModal() {
            document.getElementById('importTextarea').value = '';
            document.getElementById('importModal').classList.add('active');
            document.getElementById('importTextarea').focus();
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.remove('active');
        }

        function loadFromImportModal() {
            try {
                const jsonText = document.getElementById('importTextarea').value.trim();
                
                if (!jsonText) {
                    showToast('âš ï¸ JSON í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                    return;
                }

                const data = JSON.parse(jsonText);
                
                if (!data.templates || !Array.isArray(data.templates)) {
                    showToast('âš ï¸ ìœ íš¨í•˜ì§€ ì•Šì€ JSON í˜•ì‹ì…ë‹ˆë‹¤');
                    return;
                }

                templates = data.templates;
                customFields = data.customFields || [];
                addCustomFieldsToTemplates();
                saveSettings();
                renderTemplatesList();
                
                if (templates.length > 0) {
                    selectTemplate(templates[0].id);
                }
                
                closeImportModal();
                showToast(`âœ… ${templates.length}ê°œì˜ í…œí”Œë¦¿ì´ ë¶ˆëŸ¬ì›Œì¡ŒìŠµë‹ˆë‹¤`);
            } catch (error) {
                showToast('âš ï¸ JSON íŒŒì‹± ì˜¤ë¥˜: ' + error.message);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function escapeAttr(text) {
            return String(text).replace(/"/g, '&quot;').replace(/'/g, '&#x27;');
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2500);
        }

        init();
    </script>
</body>
</html>
